# Refactoring with IntelliJ

## Section 1 (이해하기 힘든 이름)

- 함수, 변수, 클래스, 모듈 이름 모두 어떤 역할인지 명확히 표현해야함
- 리팩토링 기술
  - 함수 선언 변경(Change Function Declaration)
  - 변수 이름 바꾸기(Rename Variable)
  - 필드 이름 바꾸기(Rename Field)

### 함수 선언 변경하기

함수 이름 변경, 메소드 이름 변경, 매개변수 추가, 매개변수 제거, 시그니처 변경

- 함수 이름만 보고도 이해할 수 있는 함수가 좋은 이름
- 함수에 주석을 작성한 다음 주석을 함수 이름으로 만들어보자
- 매개변수는
  - 내부의 문맥을 결정
  - 의존성을 결정
  - 즉, 파라미터로 객체가 오냐 아니면 특정한 타입에 오냐에 따라 함수에서 객체를 활용하여 결과를 만드는지
  아니면, 특정 타입만을 가지고 결과를 만드는지를 결정

### 변수 이름 바꾸기

- 많이 사용되는 변수일 수록 이름이 더욱 중요
  - 람다식에서 사용하는 변수 vs 함수의 매개변수
- 여러 곳에서 쓰이는 필드 이름은 깊은 고민이 필요

### 필드 이름 바꾸기

- Record 자료 구조의 필드 이름은 전역적으로 참조될 수 있게 매우 중요
  - Java 14부터 지원
  - 특정 데이터와 관련있는 필드를 묶어 놓은 자료구조
  - 파이썬의 Dictionary, dicts
  - DTO 나 VO 같은 것들을 Record 로 볼 수 있음
    - 단 Record 는 Immutable

## Section 2 (중복 코드)

- 단점
  - 비슷한지 완전히 동일한지 주의깊게 봐야함
  - 코드 변경 시, 동일한 모든 곳의 코드를 변경해야 함
- 리팩토링 기술
  - 동일한 코드를 여러 메소드에서 사용하는 경우
    - 함수 추출(Extract Function)
  - 코드가 비슷하지만 완전히 같진 않지않은 경우
    - 코드 분리(Slide Statement)
  - 여러 하위 클래스에 동일한 코드가 있다면
    - 메소드 올리기(Pull up Method)

### 함수 추출하기

- 의도와 구현을 분리
  - 어떤 함수가 어떤 일을 하는지 명확한가?
    - 책처럼 읽히지 않는 다면 구현
    - 코드는 의도를 드러내야 한다
- 어떤 작업을 하는 코드인지 알고 함수로 분리하고 함수 이름을 명확히 표현할 수 있음
  - 코드를 읽을 때 무슨 코드인지 노력하지 않도록 하자
- 한줄짜리 메서드도 괜찮을까?
  - 의도를 드러낸다면 오히려 좋다
- 함수 내 주석은 함수를 추출하는데 있어서 좋은 단서가 될 수 있음

### 코드 정리하기

- 관련있는 코드끼리 묶여있어야 더 쉽게 이해가 가능
- 함수에서 사용하는 변수는 상단이 아닌, 해당 변수를 사용하는 코드 바로 위에 선언
- 관련있는 코드끼리 묶은 다음, 함수 추출을 통해 더 깔끔하게 분리도 가능

### 메서드 올리기

- 중복 코드는 미래에 버그를 만들어 낼 가능성이 존재
  - A에서 고쳤지만 B는 안고친 경우
- 하위 클래스에 동일한 코드가 있다면 메서드 올리기를 통해 이를 극복할 수 있음
- 비슷하지만 일부 다른 경우 `함수 매개변수화하기` 리팩토링을 적용 후 메서드 올리기 적용
- 하위 클래스에 있는 코드가 `상위 클래스가 아닌 하위 클래스 기능에 의존`한다면 `필드 올리기`를 적용한 후 메서드 올리기 적용
- 두 메서드가 비슷한 절차라면 `템플릿 메소드 패턴` 적용

## Section 3(긴 함수)

- 짧은 함수 vs 긴 함수
  - 짧은 함수는 많은 문맥 전환(왔다 갔다)이 필요 vs 긴 함수는 이해하기 어려움
  - 과거에는 작은 함수는 많은 서브루틴으로 인한 오버헤드가 있었음
  - `작은 함수 + 좋은 이름`이라면 함수의 코드를 보지 않아도 이해할 수 있음
  - 주석 대신 함수를 만들고 `함수의 이름으로 의도를 표현`
- 리팩토링 기술
  - 기본적으로는 99%는 함수 추출하기로 해결
  - 매개변수가 많아 진다면
    - 임시 변수를 질의 함수로 변환(Replace Temp with Query)
    - 매개변수 객체 만들기(Introduce Parameter Object)
    - 객체 통째로 넘기기(Preserve Whole Object)
  - 조건문 분해하기(Decompose Conditional)로 조건문을 분리
  - 같은 조건으로 여러 Switch 문
    - 조건문을 다형성으로 변경(Replace Conditional with Polymorphism)
  - 반복문 안에 여러작업이 있어서 하나의 메소드로 추출하기 어렵다면
    - 반복문 쪼개기(Split Loop)

### 임시 변수를 질의 함수로 바꾸기

- 임시 변수를 만들어내는 표현식을 함수로 빼내자
- 변수를 이용하면 동일한 계산을 반복하는 것을 피할 수 있고 이름을 통해 의미를 부여할 수 있음
- 임시 변수를 함수로 추출한다면 긴 함수를 리팩토링 시, 전달해야하는 파라미터 갯수를 줄일 수 있음

### 매개 변수 객체 만들기

- 같은 매개변수들이 여러 메소드에서 나타난다면 그 매개변수들을 묶은 자료 구조를 만들 수 있음
  - 해당 데이터간의 관계를 명시적으로 나타낼 수 있음
  - 전달할 매개변수의 갯수를 줄일 수 있음
  - 도메인을 이해하는데 중요한 역할을 하는 클래스로 발전 가능

### 객체 통째로 넘기기

- 여러 파라미터들이 하나의 객체 또는 레코드에서 파생된 경우 객체 자체를 넘긴다
- 매개변수 목록을 줄일 수 있음
- 의존성을 고려해야 함
- 하지만 `해당 메소드의 위치가 적절하지 않을 수` 있음
  - Feature Envy